<!DOCTYPE html>

<!--
A grid of inline-block columns can have columns with explicit width and auto width columns. The space remaining after the explicit-width columns is distributed evenly between the rest of the columns. Columns have minimum width. When columns width exceed the available space, they are wrapped on a new row.
Used for fallback when Flexbox is not supported by the browser.
-->

<style>
	
	body {
		
		font-size: 16px;

	}
	
	.row {
	
		max-width: 800px;
		margin: 0 auto;
		
	}
	
	.row > * {
		
		font-size: 16px; /* To do: replace by actual font size of column's row's parent */
		min-width: 20%; /* To do: support +33% */
		display: inline-block;
		padding: .5em;
		margin: 0;
		border: none;
		color: #333;
		box-sizing: border-box;
		vertical-align: top;
		position: relative;

	}
	
	.row > * {
		
		max-width: 20%;
		
	}
	
	.row > * > * {
		

	}
	
	.row > *[class^=col] {
		
		max-width: none;

	}
	
	.row > .table-row {
		
		display: table;
		width: 100%;
		max-width: 100%;
		table-layout: fixed;
		border-spacing: .5em;
		border-collapse: separate;
		font-size: inherit;
		margin-bottom: -.5em;
		padding: 0;

	}

	.row > .table-row > * {
		
		display: table-cell;
		padding: .5em;
		background: #eee;
		
	}
	
	.row.no-spacing > .table-row {
		
		border-collapse: collapse;
		
	}
		
	.row.no-padding > .table-row > * {
		
		padding: 0;
		
	}
		
	.col2 {
		
		width: 50%;

	}
	
	.col3 {
		
		width: 33.333%;

	}
	
	.col23 {
		
		width: 66.667%;
		
	}

	.col4 {
		
		width: 25%;

	}
	
	.col34 {
	
		width: 75%;	
	
	}
	
	.col5 {
		
		width: 20%;	
		
	}
	
	.col25 {
	
		width: 40%;
	
	}
	
	.col35 {

		width: 60%;

	}
	
	.col45 {

		width: 80%;

	}
	
	.align-right {
		
		text-align: right;
		
	}
	
	.align-left {
		
		text-align: left;
		
	}
	
	.align-center {
		
		text-align: center;

	}
	
	.align-middle {
		
		vertical-align: middle;

	}
		
</style>

<div class='row'>
	
	<div><div>Auto Auto Auto Auto Auto Auto Auto Auto Auto Auto Auto Auto Auto Auto </div></div>
	<div class="align-right"><div>Auto<br>Right-aligned</div></div>
	<div class="col2 align-center align-middle"><div>1/2<br>Centered</div></div>
	<div><div>Auto</div></div>
	<div><div>Auto</div></div>
	<div class="col23"><div>2/3</div></div>
	<div><div>Auto</div></div>
	<div><div>Auto</div></div>
	<div class="col3"><div>1/3</div></div>
	<div class="col23"><div>2/3</div></div>
	<div><div>Auto</div></div>
	<div><div>Auto</div></div>
	<div><div>Auto</div></div>
	<div><div>Auto Last</div></div>
		
</div>

<br><br>

<div class='row'>
	
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
	<div>Auto</div>
		
</div>

<script>

	function flexGridFallback() { // Second approach: split all wrapped rows into separate .row.table
	
		var rows = document.querySelectorAll('.row'); // Node list to array
		var row_index = 0;
		
		for(;row_index < rows.length; row_index++) { // All rows
			
			var row = rows.item(row_index);

			var start_index = new Array('0');
			var end_index = new Array();
			var i = 1;
			for (;i <= row.children.length; i++) { // All columns in current row. Get start and end indices of each wrapped row.

				var el = row.children[i];
				if (i === row.children.length || el.offsetLeft === row.offsetLeft)  { // If offset is the same as the row, the row has wrapped and its columns must take up 100% width

					end_index[end_index.length] = i - 1;

/* 					console.log('Start: ' + start_index[start_index.length-1] + ', End: ' + end_index[end_index.length-1]); */

					start_index[start_index.length] = end_index[end_index.length-1] + 1;
		
				}
		
			}
			
			start_index.splice(start_index.length-1, 1); // Remove the last one

			for (i = 0; i < start_index.length; i++) {
				
				row.insertAdjacentHTML('beforeend', '<div class=table-row></div>');
				var j = start_index[i];
				while (j <= end_index[i]) {

					row.children[row.children.length-1].appendChild(row.children[0]);
					j++;
					
				}
								
				
			}
			
		}

	}

	flexGridFallback();

</script>
