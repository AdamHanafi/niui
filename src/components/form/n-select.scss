// Rich select

/*
	
Theme:

--control-color: red;
--control-bg: lightgoldenrodyellow;

--control-selected-color: blueviolet;
--control-selected-bg: aliceblue;

--control-active-color: chocolate;
--control-active-bg: beige;

*/

@keyframes n-select {
    
    100% {
	    
	    height: 0;
	    
    }
    
}
	
@keyframes n-select-native {
    
    100% {
	    
	    height: auto;

    }
    
}
    							
.n-select {
	
	position: relative;
	
	&[aria-expanded] {
	
		[aria-selected] {
			
			background-color: var(--control-selected-bg, #eee);
			color: var(--control-selected-color, #000);
			
		}

		> div {
	
			margin-top: calc(-1px * (var(--active-option-offset, 0) - var(--top-offset, 0))); // Align to the current option's vertical offset
			max-height: var(--max-height);
			overflow: auto;
		
		}
		
		button {
			
			outline-offset: -3px;

			@media (hover: hover) {

				outline-offset: -5px;

			}
			
			&:not([aria-selected]) {
			
				&:hover {
					
					background-color: var(--control-active-bg, #ececec);
					color: var(--control-active-color, inherit);
					
				}
			
			}

		}
	
	}

	button {
		
		-webkit-appearance: none;
		appearance: none;
		background: none;
		cursor: pointer;
		border: 0;
		width: 100%;
		text-align: start;
		padding: 0;
		margin: 0;
		font-size: 1em;
		position: relative;
		color: var(--control-color, #333);
		background-color: var(--control-bg, #fff);
		
		* {
			
			pointer-events: none; // Disable dragging of images inside the option

		}
		
	}
	
	&[data-ready]:before {
		
		content: '';
		display: block;
		height: var(--active-option-height, 1em);
		font-size: 1em;
		
	}
	
	&:after, > div {
		
		position: absolute;
		top: 0;
		z-index: 5;
		
	}
	
	> div {
		
		width: 100%;
		background-color: var(--control-bg, #fff);
		
		> * {
			
			display: block;
			-webkit-touch-callout: none;
			-webkit-user-select: none;
			-khtml-user-select: none;
			-moz-user-select: none;
			user-select: none;

		}

		&.n-scrollbar {

			&::-webkit-scrollbar {
			
			  width: 10px;
			
			}
	 
			&::-webkit-scrollbar-thumb {
			
			  background: #999;
			  border-radius: 20px;
			
			}
			
			&::-webkit-scrollbar-track {
			
			  background: #ddd;
			  border-radius: 20px;
			
			}
		
		}

	}
	
	&:not([aria-expanded]) {
		
		cursor: pointer;

		> div {
			
			background-image: linear-gradient(-113deg, transparent 60%, var(--control-bg, #fff) 63%), linear-gradient(113deg, transparent 60%, var(--control-bg, #fff) 63%), linear-gradient(to bottom, var(--control-color, #333), var(--control-color, #333));
			background-size: .75em .75em;
			background-repeat: no-repeat;
			background-position: calc(100% - .5em) .75em;
		
		}
	
		button {
			
			white-space: nowrap;
			overflow: hidden;
			width: calc(100% - 1.5em);
			outline-offset: -1.5px;
			
		}
		
		> div > :not([aria-selected]) {
		
			display: none;
			
		}

	}

	div > *, button {
		
		padding: .5em;
		
	}
	
}

.n-select:not([data-ready]) {

	// If no init in 2", display native fallback

    animation-name: n-select;
    overflow: hidden;
    
    &, & + select {
	    
	    animation-duration: .1s;
	    animation-fill-mode: forwards;
	    animation-delay: 2s;

    }
    
	& + select {
	    
	    animation-name: n-select-native;
	
		-webkit-appearance: none;
		appearance: none;
		border: none;
		height: 0;
	
	}
						    
	&:not([aria-expanded]) > div { // Before init. If there is no selected item, display the first one. Otherwise, display the selected item it on top of the first one.
		
		position: relative;
	
		> :not([aria-selected]):first-child {
			
			display: block;

			~ [aria-selected] {
				
				display: block;
				position: absolute;
			    top: 0;
				
			}
			
		}
	
	}

}

select[data-n_select], .n-select[data-ready] select, .n-select[data-ready] + select { // Hide the associated native select, which can be specified in 3 different ways
	
	display: none;
	
}

// Animation

.n-select[aria-expanded] > div {

	-webkit-mask: 				linear-gradient(0, #000, #000) no-repeat 0 var(--mask-position-y) / 100% var(--mask-size-y);

}

.n-select[aria-expanded] > div[data-n-select-animation] {

	transition: 				-webkit-mask-size .15s ease-in-out, -webkit-mask-position-y .15s ease-in-out;
	-webkit-mask-size: 			100% 100%; 
	-webkit-mask-position-y: 	0;

}
